!function(){"use strict";var a=function(a){return null!=a},b=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,c=function(a){return a=a.toLowerCase(),"true"===a||"false"===a},d=function(a,d,e,f){var i,g="return ",h=f?function(a,d){return b.test(a)?"Number(values["+d+"]),":c(a)?"Boolean(values["+d+"].toLowerCase() === 'true'),":"String(values["+d+"]),"}:function(a,b){return"values["+b+"],"};if("object"===a){for(g+="{",i=0;i<d.length;++i)g+='"'+d[i]+'": '+h(e[i],i);g=g.slice(0,-1)+"}"}else{for(g+="[",i=0;i<d.length;++i)g+=h(e[i],i);g=g.slice(0,-1)+"]"}return new Function("values",g)},e=function(b,c){if(c=a(c)?c:{},this.options={async:a(c.async)?c.async:!1,cast:a(c.cast)?c.cast:!0,line:a(c.line)?c.line:"\r\n",delimiter:a(c.delimiter)?c.delimiter:",",header:a(c.header)?c.header:!1,done:a(c.done)?c.done:void 0},this.data=b,this.data instanceof Array)return this;for(var d=0;d<this.options.line.length;d++){var e=b.charCodeAt(b.length-this.options.line.length+d),f=this.options.line.charCodeAt(d);e!=f&&(this.data+=this.options.line.charAt(d))}return this};e.prototype.set=function(a,b){return this.options[a]=b,this},e.prototype.encode=function(b){if(0===this.data.length)return"";var l,m,n,o,p,q,c=this.data,d=[],e=this.options.delimiter,f=c[0]instanceof Array?"array":"object",g=this.options.header,h=this.options.done,i=function(b){return a(b)?"string"!=typeof b?b:'"'+b.replace(/\"/g,'""')+'"':null},j=b?function(a){b(a.join(e))}:function(a){d.push(a.join(e))},k=c.length;if("object"===f?(n=Object.keys(c[0]),o=n.length):o=c[0].length,q=new Array(o),g){var r=g instanceof Array?g:n;for(m=0;o>m;++m)q[m]=i(r[m]);j(q)}if("object"===f)for(l=0;k>l;++l){for(p=c[l],m=0;o>m;++m)q[m]=i(p[n[m]]);j(q)}else for(l=0;k>l;++l){for(p=c[l],m=0;o>m;++m)q[m]=i(p[m]);j(q)}return d=d.join(this.options.line),h&&h(d),d},e.prototype.parse=function(a){if(0===this.data.trim().length)return[];var m,r,s,w,b=this.data,c=[],e=this.options.done,f=this.options.cast,g=this.options.header,h=g instanceof Array?g:[],i=this.options.line,j=h.length,k={row:[],cell:""},l={escaped:!1,quote:!1,cell:!0},n=function(a){k.row.push((l.escaped?a.slice(1,-1).replace(/""/g,'"'):a).trim()),k.cell="",l={escaped:!1,quote:!1,cell:!0}},o=1===i.length?n:function(a){n(a.slice(0,1-i.length))},p=a?function(){a(new m(k.row))}:function(){c.push(new m(k.row))},q=function(){g?j?(m=new d("object",h,k.row,f),p(),q=p):(h=k.row,j=h.length):(m||(m=new d("array",k.row,k.row,f)),p(),q=p)},t=b.length,u=i.charCodeAt(i.length-1),v=this.options.delimiter.charCodeAt(0);for(r=0,s=0;t>=s;++s)w=b.charCodeAt(s),l.cell&&(l.cell=!1,34===w)?l.escaped=!0:l.escaped&&34===w?l.quote=!l.quote:(l.escaped&&l.quote||!l.escaped)&&(w===v?(n(k.cell+b.slice(r,s)),r=s+1):w===u&&(o(k.cell+b.slice(r,s)),r=s+1,q(),k.row=[]));return e&&e(c),c},e.prototype.forEach=function(a){return this.data instanceof Array?this.encode(a):this.parse(a)},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:window&&(window.CSV=e)}();